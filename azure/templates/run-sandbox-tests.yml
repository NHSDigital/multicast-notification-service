parameters:
  - name: test_command
    type: string
    default: 'make test'

steps:
  - bash: |
      cd sandbox
      make install
    workingDirectory: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)
    displayName: Setup sandbox tests
    condition: always()

  - bash: |
      make test
      make test-report
    workingDirectory: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)
    displayName: Run sandbox tests
    condition: always()

  - task: PublishTestResults@2
      displayName: 'Publish sandbox results'
      condition: always()
      inputs:
        testResultsFiles: '$(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)/sandbox-report.xml'
        failTaskOnFailedTests: true